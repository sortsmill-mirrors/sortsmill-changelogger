#!@SHELL@
# -*- sh -*-

copyright_string="Copyright (C) 2013 Khaled Hosny and Barry Schwartz"

# Copyright (C) 2013 Khaled Hosny and Barry Schwartz
# This file is part of Sorts Mill Changelogger.
# 
# Sorts Mill Changelogger is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
# 
# Sorts Mill Changelogger is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <http://www.gnu.org/licenses/>.

set -e

progname=`basename "${0}"`

# An undocumented environment variable. It is not certain we will
# retain it.
if test -z "${SORTSMILL_DIST_CHANGELOG_AM}"; then
    SORTSMILL_DIST_CHANGELOG_AM='@DEFAULT_DIST_CHANGELOG_AM@'
fi

targetdir_wanted=no
help_wanted=no
version_wanted=no

while getopts 'd:hV' flag
do
    case "${flag}" in
        d)
            targetdir_wanted=yes
            targetdir="${OPTARG}"
            if test -z "${targetdir}"; then
                echo "${progname}: '-d' requires a non-empty argument."
                echo "Try '""${progname}"" -h' for more information."
                exit 3
            fi
            ;;

        h)
            help_wanted=yes
            ;;
        V)
            version_wanted=yes
            ;;
        ?)
            echo "Try '""${progname}"" -h' for more information."
            exit 2
            ;;
    esac
done

echo_help() {
    echo "Usage: ${progname} [OPTION]..."
    echo "Prepare a package to use @PACKAGE@."
    echo ""
    echo "  -d DIR   put files in DIR, which is created if necessary"
    echo "  -h       display this help and exit"
    echo "  -V       output version information and exit"
    echo ""
    echo "Unless -h or -V is specified, the file"
    echo ""
    echo "    sortsmill-dist-changelog.am"
    echo ""
    echo "will be placed in DIR or the current directory."
    echo ""
    echo "You should put in Automake.am a line like the following:"
    echo ""
    echo "    include DIR/sortsmill-dist-changelog.am"
    echo ""
    echo "Report sortsmill-changloggerize bugs at @PACKAGE_BUGREPORT@"
    echo "@PACKAGE_NAME@ home page: @PACKAGE_URL@"
}

echo_version() {
    echo "sortsmill-changeloggerize @VERSION@"
    echo "${copyright_string}"
    echo ""
    echo "License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>."
    echo "This is free software: you are free to change and redistribute it."
    echo "There is NO WARRANTY, to the extent permitted by law."
    echo ""
    echo "Written by Barry Schwartz."
}

changeloggerize() {
    cp "${SORTSMILL_DIST_CHANGELOG_AM}" "${1}/sortsmill-dist-changelog.am"
}

if test x"${help_wanted}" = xyes; then
    echo_help
elif test x"${version_wanted}" = xyes; then
    echo_version
else
    if test x"${targetdir_wanted}" = xyes; then
        mkdir -p "${targetdir}"
        changeloggerize "${targetdir}"
    else
        changeloggerize .
    fi
fi

exit 0
